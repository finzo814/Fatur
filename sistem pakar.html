<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AC Analyzer — Forward Chaining Expert System</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#00d1ff;--muted:#9aa6b2;--success:#22c55e}
    *{box-sizing:border-box}
    body{font-family:Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; background:linear-gradient(180deg,#071126 0%, #0b1624 100%); color:#e6eef6; margin:0; padding:28px}
    .wrap{max-width:1100px;margin:0 auto}
    header{display:flex;gap:20px;align-items:center}
    header h1{margin:0;font-size:20px}
    header p{margin:0;color:var(--muted)}
    .grid{display:grid;grid-template-columns:1fr 420px;gap:20px;margin-top:22px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:18px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6);}
    .section-title{font-weight:600;margin-bottom:8px}
    .symptoms{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
    label{display:flex;gap:10px;align-items:center;background:transparent;padding:8px;border-radius:8px}
    input[type=checkbox]{width:18px;height:18px}
    button.primary{background:var(--accent);color:#022; border:none;padding:10px 14px;border-radius:9px;font-weight:600;cursor:pointer}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:8px;color:var(--muted);cursor:pointer}
    .output pre{white-space:pre-wrap;margin:0}
    .rule-trace{font-size:13px;color:var(--muted);margin-top:8px}
    .tag{display:inline-block;background:rgba(255,255,255,0.03);padding:6px 8px;border-radius:999px;margin:4px 4px 0 0;font-size:13px}
    .install ol{padding-left:18px}
    footer{margin-top:18px;color:var(--muted);font-size:13px}
    .badges{display:flex;flex-wrap:wrap}
    .solution{background:rgba(34,197,94,0.12);color:var(--success);padding:10px;border-radius:8px;margin-top:10px}
    @media(max-width:980px){.grid{grid-template-columns:1fr} .symptoms{grid-template-columns:repeat(1,1fr)}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>AC Analyzer — Sistem Pakar (Forward Chaining)</h1>
        <p>Analisis kerusakan AC, rekomendasi penanganan, dan cara instalasi. Pilih gejala di sebelah kiri lalu tekan <strong>Analisa</strong>.</p>
      </div>
    </header>

    <div class="grid">
      <div class="card">
        <div class="section-title">Pilih Gejala (Symptoms)</div>
        <div class="symptoms" id="symptom-list">
          <!-- checkboxes injected by JS -->
        </div>

        <div style="margin-top:12px;display:flex;gap:10px">
          <button class="primary" id="run">Analisa (Forward Chaining)</button>
          <button class="ghost" id="reset">Reset</button>
          <button class="ghost" id="export">Export Laporan</button>
        </div>

        <div class="rule-trace" id="trace"></div>
      </div>

      <div class="card">
        <div class="section-title">Hasil Analisis & Rekomendasi</div>
        <div class="output" id="output">Belum dianalisis — pilih gejala lalu klik <strong>Analisa</strong>.</div>

        <div style="margin-top:12px" class="section-title">Saran Perbaikan</div>
        <div id="solutions"></div>

        <div style="margin-top:12px" class="section-title">Langkah Instalasi (Ringkasan)</div>
        <div class="install">
          <ol>
            <li>Siapkan unit indoor dan outdoor, alat (bor, kunci, vacuum pump, manifold, tabung freon sesuai spesifikasi).</li>
            <li>Pilih lokasi pemasangan indoor dan outdoor; jaga jarak dan ventilasi.</li>
            <li>Buat jalur pipa dan kabel, pasang braket outdoor & indoor.</li>
            <li>Sambungkan pipa refrigerant (copper) sesuai ukuran, kencangkan sambungan, lakukan vakum (vacuum pump) untuk hilangkan udara & kelembapan.</li>
            <li>Isi freon sesuai tipe dan jumlah yang direkomendasikan pabrik; periksa kebocoran (bubble test / detector).</li>
            <li>Hidupkan sistem, cek tekanan, suhu keluar, dan bunyi; lakukan pengukuran akhir dan beri edukasi pemakaian pada pemilik.</li>
          </ol>
          <p style="font-size:13px;color:var(--muted)">Catatan: pekerjaan yang melibatkan refrigerant dan listrik harus dikerjakan teknisi bersertifikat.</p>
        </div>
      </div>
    </div>

    <div style="margin-top:18px" class="card">
      <div class="section-title">Tentang Aturan (Rules) — Forward Chaining</div>
      <p style="color:var(--muted)">Sistem ini memakai forward chaining: dari gejala (facts) kita cocokkan aturan yang kondisinya terpenuhi. Jika aturan terpenuhi, maka kesimpulan (misal: "Kebocoran Freon") ditambahkan ke facts dan bisa memicu aturan lain. Sistem merekam jejak aturan yang dipakai untuk transparansi.</p>

      <div style="margin-top:10px" class="badges" id="rule-badges"></div>
    </div>

    <footer>
      Simpan file ini sebagai <code>ac-analyzer.html</code> lalu buka di browser. Jika mau tambahan aturan, solusi teknis lebih detail, atau ekspor PDF, beri tahu saya.
    </footer>
  </div>

  <script>
    // --- Domain data: gejala, aturan, solusi ---
    const SYMPTOMS = [
      {id:'not_cold', label:'AC tidak dingin'},
      {id:'weak_airflow', label:'Aliran udara lemah / kipas lambat'},
      {id:'weird_noise', label:'Bunyi berisik / berdengung'},
      {id:'water_leak', label:'Air menetes / bocor dari indoor'},
      {id:'ice_on_pipe', label:'Bentuk es pada pipa (frost) atau evaporator'},
      {id:'trips_breaker', label:'MCB turun / pemutus trip'},
      {id:'no_power', label:'AC tidak menyala (indikator mati)'},
      {id:'bad_smell', label:'Bau tidak sedap dari AC'},
      {id:'high_power', label:'Tagihan listrik melonjak / konsumsi tinggi'},
    ];

    // rules: {id, conditions:[], conclusion: 'key', description}
    const RULES = [
      {id:'r1', conditions:['not_cold','ice_on_pipe'], conclusion:'low_refrigerant', description:'Ada pembekuan -> kemungkinan kebocoran atau pengisian freon kurang'},
      {id:'r2', conditions:['not_cold','weird_noise'], conclusion:'compressor_fault', description:'Tidak dingin + bunyi -> masalah kompresor atau kopling'},
      {id:'r3', conditions:['not_cold','weak_airflow'], conclusion:'dirty_filter_or_coil', description:'Aliran lemah -> filter/evaporator kotor'},
      {id:'r4', conditions:['water_leak','ice_on_pipe'], conclusion:'defrost_issue_or_refrigerant', description:'Bocor & es -> siklus pembuangan cairan terganggu / freon bocor'},
      {id:'r5', conditions:['trips_breaker','weird_noise'], conclusion:'electrical_short', description:'MCB trip + bunyi -> kemungkinan short / motor overcurrent'},
      {id:'r6', conditions:['no_power'], conclusion:'power_issue', description:'AC tidak menyala -> cek sumber listrik, fuse, remote battery'},
      {id:'r7', conditions:['bad_smell','water_leak'], conclusion:'mold_or_blocked_drain', description:'Bau + bocor -> saluran pembuangan tersumbat / lumut'},
      {id:'r8', conditions:['high_power','not_cold'], conclusion:'overload_or_compressor', description:'Daya tinggi tapi tidak dingin -> kompresor overload atau refrigerant tidak tepat'},
      {id:'r9', conditions:['dirty_filter_or_coil'], conclusion:'clean_filter_coil', description:'Rekomendasi: bersihkan filter dan coil'},
      {id:'r10', conditions:['low_refrigerant'], conclusion:'check_leak_and_recharge', description:'Periksa kebocoran dan isi freon sesuai spesifikasi'},
      {id:'r11', conditions:['compressor_fault'], conclusion:'replace_or_service_compressor', description:'Servis/replace kompresor oleh teknisi'},
      {id:'r12', conditions:['power_issue'], conclusion:'check_electrical_supply', description:'Periksa sambungan listrik, MCB, dan remote'},
      {id:'r13', conditions:['mold_or_blocked_drain'], conclusion:'clean_drain_and_disinfect', description:'Bersihkan saluran pembuangan dan desinfeksi evaporator'},
    ];

    // mapping conclusion -> human-friendly solution text
    const SOLUTIONS = {
      low_refrigerant: 'Kemungkinan kebocoran refrigerant. Lakukan pengecekan kebocoran (detector/bubble test), perbaiki sambungan bocor, lalu isi ulang refrigerant sesuai tipe pabrik (oleh teknisi berlisensi).',
      compressor_fault: 'Kompresor bermasalah. Lakukan pengecekan tekanan, arus listrik; servis atau ganti kompresor jika diperlukan (oleh teknisi).',
      dirty_filter_or_coil: 'Filter atau evaporator kotor. Lepas dan bersihkan filter, lakukan pembersihan coil/evaporator. Periksa juga blower fan.',
      check_leak_and_recharge: 'Periksa titik kebocoran, perbaiki, vakum sistem, lalu isi refrigerant sesuai kapasitas unit.',
      replace_or_service_compressor: 'Servis mendalam atau penggantian kompresor — biasanya membutuhkan penggantian sparepart dan pengisian ulang refrigerant.',
      power_issue: 'Periksa sumber listrik, kabel, MCB, dan stack remote/baterai. Jika ada kerusakan kabel atau komponen listrik, hubungi teknisi listrik.',
      clean_drain_and_disinfect: 'Bersihkan pipa pembuangan dan lakukan desinfeksi evaporator untuk menghilangkan lumut/bakteri. Pastikan jalur drain tidak tersumbat.'
    };

    // UI init
    const symptomList = document.getElementById('symptom-list');
    SYMPTOMS.forEach(s=>{
      const lbl = document.createElement('label');
      lbl.innerHTML = `<input type=checkbox data-id='${s.id}' /> <span>${s.label}</span>`;
      symptomList.appendChild(lbl);
    });

    const runBtn = document.getElementById('run');
    const resetBtn = document.getElementById('reset');
    const output = document.getElementById('output');
    const solutionsDiv = document.getElementById('solutions');
    const traceDiv = document.getElementById('trace');
    const exportBtn = document.getElementById('export');
    const ruleBadges = document.getElementById('rule-badges');

    // show rule badges
    RULES.forEach(r=>{
      const d = document.createElement('div'); d.className='tag'; d.textContent = `${r.id}: if [${r.conditions.join(', ')}] → ${r.conclusion}`; ruleBadges.appendChild(d);
    });

    function getSelectedFacts(){
      const checks = Array.from(document.querySelectorAll('#symptom-list input:checked'));
      return new Set(checks.map(c=>c.dataset.id));
    }

    function forwardChaining(initialFacts){
      const facts = new Set(initialFacts);
      const fired = new Set();
      const trace = [];
      let changed = true;
      while(changed){
        changed = false;
        for(const r of RULES){
          if(fired.has(r.id)) continue;
          const ok = r.conditions.every(c=>facts.has(c));
          if(ok){
            // add conclusion
            if(!facts.has(r.conclusion)){
              facts.add(r.conclusion);
              changed = true;
            }
            fired.add(r.id);
            trace.push({ruleId:r.id, cond:r.conditions.slice(), conclusion:r.conclusion, desc:r.description});
          }
        }
      }
      return {facts, trace};
    }

    runBtn.addEventListener('click', ()=>{
      const selected = getSelectedFacts();
      if(selected.size===0){ output.innerHTML = '<em>Pilih minimal satu gejala.</em>'; solutionsDiv.innerHTML=''; traceDiv.textContent=''; return; }
      const result = forwardChaining(selected);

      // Build human-readable conclusions
      const conclusions = Array.from(result.facts).filter(f=>!(SYMPTOMS.some(s=>s.id===f)));
      const actionable = conclusions.filter(c=>SOLUTIONS[c]);

      // Output
      let html = '';
      if(conclusions.length===0) html = '<em>Tidak ada kesimpulan dari gejala yang dipilih. Pertimbangkan menambah gejala atau pemeriksaan teknis.</em>';
      else{
        html = '<strong>Kesimpulan (facts tambahan):</strong> <div style="margin-top:8px">';
        html += conclusions.map(c=>`<div class="tag">${c}</div>`).join(' ');
        html += '</div>';
      }
      output.innerHTML = html;

      // Solutions
      if(actionable.length>0){
        solutionsDiv.innerHTML = '';
        actionable.forEach(a=>{
          const box = document.createElement('div'); box.className='solution';
          box.innerHTML = `<strong>${a.replaceAll('_',' ')}</strong><div style="margin-top:6px">${SOLUTIONS[a]}</div>`;
          solutionsDiv.appendChild(box);
        });
      } else {
        solutionsDiv.innerHTML = '<div style="color:var(--muted)">Belum ada rekomendasi otomatis; pertimbangkan pemeriksaan lanjutan.</div>';
      }

      // Trace
      if(result.trace.length>0){
        traceDiv.innerHTML = '<strong>Jejak inferensi:</strong><br>' + result.trace.map(t=>`[${t.ruleId}] if (${t.cond.join(' + ')}) → ${t.conclusion} — ${t.desc}`).join('<br>');
      } else {
        traceDiv.innerHTML = '<em>Tidak ada aturan yang terpenuhi.</em>';
      }
    });

    resetBtn.addEventListener('click', ()=>{
      document.querySelectorAll('#symptom-list input').forEach(i=>i.checked=false);
      output.innerHTML = 'Belum dianalisis — pilih gejala lalu klik <strong>Analisa</strong>.';
      solutionsDiv.innerHTML=''; traceDiv.textContent='';
    });

    exportBtn.addEventListener('click', ()=>{
      const selected = Array.from(getSelectedFacts());
      const result = forwardChaining(getSelectedFacts());
      const conclusions = Array.from(result.facts).filter(f=>!(SYMPTOMS.some(s=>s.id===f)));
      const actionable = conclusions.filter(c=>SOLUTIONS[c]);
      const lines = [];
      lines.push('AC Analyzer — Laporan');
      lines.push('Tanggal: ' + new Date().toLocaleString());
      lines.push('\nGejala terpilih:');
      selected.forEach(s=>{ const label = SYMPTOMS.find(x=>x.id===s)?.label || s; lines.push('- ' + label); });
      lines.push('\nKesimpulan:');
      conclusions.forEach(c=> lines.push('- ' + c));
      lines.push('\nRekomendasi:');
      actionable.forEach(a=> lines.push('- ' + (SOLUTIONS[a]||a)));

      const blob = new Blob([lines.join('\n')], {type:'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'ac-report.txt'; a.click(); URL.revokeObjectURL(url);
    });

  </script>
</body>
</html>
